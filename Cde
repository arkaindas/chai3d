class WordGuessGame {
  constructor(words, maxAttempts = 5) {
    this.words = words;
    this.maxAttempts = maxAttempts;
    this.currentAttempts = maxAttempts;
    this.currentWord = '';
    this.currentClue = '';
    this.currentFunFact = '';

    // Elements
    this.wordBox = document.getElementById('word-box');
    this.clueBox = document.getElementById('clue');
    this.attemptsBox = document.getElementById('attempts');
    this.submitBtn = document.getElementById('submit');
    this.revealBtn = document.getElementById('reveal');
    this.tryNewBtn = document.getElementById('try-new');

    // Bind events
    this.bindEvents();
    this.loadNewWord();
  }

  bindEvents() {
    this.submitBtn.addEventListener('click', () => this.validateAnswer());
    this.revealBtn.addEventListener('click', () => this.revealWord());
    this.tryNewBtn.addEventListener('click', () => this.loadNewWord());
  }

  loadNewWord() {
    this.wordBox.innerHTML = '';
    this.currentAttempts = this.maxAttempts;
    this.updateAttempts();

    const randomIndex = Math.floor(Math.random() * this.words.length);
    const selected = this.words[randomIndex];
    this.currentWord = selected.word.toUpperCase();
    this.currentClue = selected.clue;
    this.currentFunFact = selected.funFact;

    this.clueBox.innerHTML = `<p>${this.currentClue}</p>`;

    // Random hint letter
    const hintIndex = Math.floor(Math.random() * this.currentWord.length);

    for (let i = 0; i < this.currentWord.length; i++) {
      const input = document.createElement('input');
      input.maxLength = 1;

      // Prefilled hint
      if (i === hintIndex) {
        input.value = this.currentWord[i];
        input.disabled = true;
        input.classList.add('correct');
      }

      // Move to next input automatically
      input.addEventListener('input', (e) => this.handleInput(e, i));

      this.wordBox.appendChild(input);
    }

    const firstInput = this.wordBox.querySelector('input:not(:disabled)');
    if (firstInput) firstInput.focus();
  }

  handleInput(e, index) {
    const inputs = this.wordBox.querySelectorAll('input');
    const value = e.target.value.toUpperCase();
    e.target.value = value;

    if (value && index < inputs.length - 1) {
      let nextIndex = index + 1;
      while (nextIndex < inputs.length && inputs[nextIndex].disabled) {
        nextIndex++;
      }
      if (nextIndex < inputs.length) {
        inputs[nextIndex].focus();
      }
    }
  }

  validateAnswer() {
    if (this.currentAttempts <= 0) return;

    const inputs = this.wordBox.querySelectorAll('input');
    let guess = '';

    inputs.forEach((input, i) => {
      const val = input.value.toUpperCase();
      guess += val || '_';

      if (!input.disabled) {
        if (val === this.currentWord[i]) {
          input.classList.add('correct');
          input.classList.remove('wrong');
        } else {
          input.classList.add('wrong');
          input.classList.remove('correct');
        }
      }
    });

    if (guess === this.currentWord) {
      this.showFunFact();
    } else {
      this.currentAttempts--;
      this.updateAttempts();

      if (this.currentAttempts === 0) {
        setTimeout(() => {
          alert(`❌ Out of attempts! The word was ${this.currentWord}`);
          this.revealWord();
        }, 200);
      }
    }
  }

  revealWord() {
    const inputs = this.wordBox.querySelectorAll('input');
    for (let i = 0; i < this.currentWord.length; i++) {
      inputs[i].value = this.currentWord[i];
      inputs[i].classList.add('correct');
      inputs[i].disabled = true;
    }
  }

  showFunFact() {
    this.clueBox.innerHTML = `
      <div class="fun-fact">
        <strong>Fun Fact:</strong> ${this.currentFunFact}
      </div>
    `;
  }

  updateAttempts() {
    this.attemptsBox.textContent = `Attempts Remaining: ${this.currentAttempts}`;
  }
}

// Initialize game
const wordData = [
  {
    word: 'TURBINE',
    clue: 'Machine used to generate electricity from wind or water',
    funFact: 'A single wind turbine can generate enough electricity to power over 1,500 homes for a year!'
  },
  {
    word: 'ENGINE',
    clue: 'Machine that converts fuel into motion',
    funFact: 'The world’s first practical internal combustion engine was built in 1859!'
  },
  {
    word: 'BATTERY',
    clue: 'Device that stores electrical energy',
    funFact: 'The first true battery was invented by Alessandro Volta in 1800.'
  },
  {
    word: 'GENERATOR',
    clue: 'Converts mechanical energy into electrical energy',
    funFact: 'Generators rely on electromagnetic induction discovered by Michael Faraday.'
  }
];

const game = new WordGuessGame(wordData);
